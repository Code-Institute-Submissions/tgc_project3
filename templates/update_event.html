{% extends 'base_account.template.html'%}

{%block content%}
<div class="row justify-content-center">
    <div class="col-md-7 section-title">
        <h2>Create an event</h2>
        <form method="POST">
            <div class="form-group">
                <label>Event Name</label>
                <input type="text" class="form-control" name="prog_name" required value="{{event.prog_name}}"/><br/>
                <label>Event Date</label>
                <input type="date" name="prog_date" value="{{event.prog_date}}" class="form-control" required/><br/>
                <label>Event Details</label>
                <input type="text" name="prog_desc" class="form-control" value="{{event.prog_desc}}" required/><br>
                <label>Event Duration (Hour)</label>
                <input type="number" name="duration" min="0" value="{{event.duration}}" class="form-control" required/><br/>
                <label>Number of Volunteer</label>
                <input type="number" min="0" name="num_volunteer_req" value="{{event.num_volunteer_req}}" class="form-control" required/><br/>
                <label>Organisation</label>
                <select class="custom-select mr-sm-2" name="prog_org">
                    {% for u in all_users %}
                        <option value="{{u._id}}">{{u.org_name}}</option>
                    {%endfor%}
                </select><br/><br/>
                <label>Upload Event Image</label>
                <div>
                    <a id="upload_widget" class="cloudinary-button">Upload files</a>
                    <input type="hidden" id="uploaded_file_url" name="uploaded_file_url"/>
                    <br/>
                    <p id="uploaded_file_display" style="display:none">Uploaded File Name:<span id="uploaded_file_name"></span></p>
                </div>
                <br>
                <br>
                <button type="submit" class="btn btn-primary">Update event</button><br>
                <a href="{{ url_for('dashboard') }}">Cancel</a>
            </div>
        </form>
    </div>
</div>
{%endblock%}

{%block js%}
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>

<script type="text/javascript">
    var myWidget = cloudinary.createUploadWidget({
        cloudName: '{{cloud_name}}', 
        uploadPreset: '{{upload_preset}}'}, (error, result) => { 
            if (!error && result && result.event === "success") { 
                console.log('Done! Here is the image info: ', result.info); 
                let fileURL = document.querySelector('#uploaded_file_url');
                fileURL.value = result.info.url;

                let filenameDisplay = document.querySelector('#uploaded_file_display');

                // make it appear (by setting it to display: block)
                filenameDisplay.style.display = 'block';

                // fill in the file name
                let filenameDisplaySpan = document.querySelector("#uploaded_file_name");
                filenameDisplaySpan.innerText = result.info.original_filename;
            }
        }
    )

    document.getElementById("upload_widget").addEventListener("click", function(){
            myWidget.open();
    }, false);
</script>
{%endblock%}



